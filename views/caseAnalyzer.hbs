<h1>Case Analyzer</h1>
{{#if caseNumber}}
    <h3>Case: {{caseNumber}}</h3> 
{{/if}}
<div class="container">
    <input type="number" id="numberCaseInput" placeholder="Github case number">
    <button id="apiCallButton" >Submit</button>
    <div style=" display: none;" id="loading-logo">Asking to AI to analyze this case... </div>
    <p></p>Case:
    <div id="case-analysis" style="height: 300px; overflow: scroll;"></div>
    SSU:
    <div id="ssu-path"></div>
    <div id="ssu-analysis" style="height: 300px; overflow: scroll;"></div>
    

</div>
<script>

    document.getElementById('apiCallButton').addEventListener('click', async () => {
        document.getElementById("case-analysis").innerHTML  = ""; 
        document.getElementById("ssu-analysis").innerHTML  = ""; 
        document.getElementById("ssu-path").innerHTML  = ""; 
        document.getElementById("loading-logo").style.display = "block";
        var num =  document.getElementById('numberCaseInput').value
        const url = 'https://api.github.com/repos/IGCIT/Intel-GPU-Community-Issue-Tracker-IGCIT/issues/';
        try {

            const caseRaw = await fetch(url+num);
            if(!caseRaw.ok){
                document.getElementById('case-analysis').innerText = "Case number does not exists";
            } else {
                const caseInfo = await caseRaw.json();

                response = await fetch("/caseanalyzer/case", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify(caseInfo),
                });
                const data = await response.json();

                document.getElementById('ssu-path').innerText = data["SSU-path"];
                document.getElementById('ssu-analysis').innerText = data["SSU-analysis"];
                document.getElementById('case-analysis').innerText = data["case-analysis"].Summary; 
            }
            document.getElementById("loading-logo").style.display = "none";
        } catch (error) {
            document.getElementById('ssu-path').innerText = error;
        }
    });


</script>